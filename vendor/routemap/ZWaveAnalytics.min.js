window.ZWaveNetworkAnalyticsLib=function(){function q(b,a){return b.length===a.length&&b.every(function(b,d){return b===a[d]})}function k(b){return b.reduce(function(a,b){return a+b},0)}function m(b){return b?k(b)/b.length:void 0}function r(b){return b.filter(function(a,b,d){return d.indexOf(a)===b})}function n(b){b.sort(function(a,b){return a-b})}function h(b,a){this.src=b;this.h=a;this.j=[];this.K=this.v=0}function f(){this.links=[]}function l(b,a){this.src=b;this.h=a;this.c=[];this.w=this.m=this.o=
this.I=0}function p(b){this.u=0;this.path=b.slice()}function g(){this.s=[]}function e(b,a,c){this.a=b;this.N=a;this.W=c||[];this.i=this.a.controller.data.nodeId.value;this.F=[];this.links=[];this.b=new f;this.g=new g;this.L=[];this.$();this.Y();this.Z();this.X()}h.prototype.use=function(b,a,c,d){this.v+=d?d:1;c=127===c||void 0===c||10<c||-128>c?null:125===c?-128:126===c?10:c;null!==c&&this.j.push(c)};h.prototype.A=function(){this.K++};h.prototype.usage=function(){return this.v};h.prototype.H=function(){return this.j};
f.prototype.use=function(b,a,c,d){this.f(b,a).use(b,a,c,d)};f.prototype.A=function(b,a){this.f(b,a).A()};f.prototype.O=function(b,a,c,d,t){var e=c.slice();e.unshift(b);b=c.slice();b.push(a);a=d?d.slice():void 0;for(c=0;c<e.length;c++)this.use(e[c],b[c],d?a[c]:void 0,t)};f.prototype.f=function(b,a){var c=this.links.filter(function(c){return c.src==b&&c.h==a})[0];c||(c=new h(b,a),this.links.push(c));return c};f.prototype.usage=function(b,a){var c=Math.max(0,Math.max.apply(null,this.links.map(function(a){return a.usage()}))),
d=this.f(b,a).usage();return 0!==c?d/c:0};f.prototype.M=function(b,a){var c=this.f(b,a),d=c.usage();return 0!==d?c.K/d:0};f.prototype.H=function(b,a){var c;(c=m(this.f(b,a).j))||(c=m(this.f(b,a).j));return c?(c-0)/-100:0};l.prototype.J=function(b,a){var c=this.c.filter(function(a){return q(a.path,b)})[0];c||(c=new p(b),this.c.push(c));c.use();this.I++;this.o+=a};l.prototype.G=function(b){this.m++;this.w+=b?1:0};l.prototype.getStats=function(){var b=this.c.map(function(a){return a.path.length});console.log(this.m,
" ",this.src," ",this.h);return{ca:Math.min.apply(null,b),ba:Math.max.apply(null,b),o:this.I?this.o/this.I:null,aa:this.m?this.w/this.m:null}};p.prototype.use=function(){this.u++};g.prototype.l=function(b,a){var c=this.s.filter(function(c){return c.src==b&&c.h==a})[0];c||(c=new l(b,a),this.s.push(c));return c};g.prototype.J=function(b,a,c,d){this.l(b,a).J(c,d)};g.prototype.G=function(b,a,c){this.l(b,a).G(c)};g.prototype.V=function(b,a){return this.l(b,a).c};g.prototype.D=function(b,a){return this.l(b,
a).getStats()};g.prototype.C=function(b,a){var c=this.V(b,a),d=new f;c.forEach(function(c){d.O(b,a,c.path,void 0,c.u)});return d};g.prototype.T=function(b){var a=0,c=0;this.s.forEach(function(d){a+=k(d.c.map(function(a){return-1===a.path.indexOf(b)?0:a.u}));c+=k(d.c.map(function(a){return a.u}))});return c?a/c:0};g.prototype.B=function(b){var a=[];this.s.forEach(function(c){0<k(c.c.map(function(a){return-1===a.path.indexOf(b)?0:1}))&&a.push(c.h)});n(a);return a};e.prototype.$=function(){var b=this;
this.N.forEach(function(a){a.frameType&&b.g.G(a.nodeId,b.i,"Explore Frame"===a.frameType)});this.N.forEach(function(a){a.delivered&&a.hops&&(b.g.J(b.i,a.nodeId,a.hops,a.tries-1),b.b.O(b.i,a.nodeId,a.hops,a.returnRSSI,1),0!=a.lastFailPath[0]&&b.b.A(a.lastFailPath[0],a.lastFailPath[1]))})};e.prototype.Y=function(){var b=this;for(a in this.a.devices){var a=parseInt(a,10);if(1!=this.a.devices[a].data.basicType.value){var c=a===this.i?"Controller":!1===this.a.devices[a].data.isListening.value?!0===this.a.devices[a].data.sensor250.value||
!0===this.a.devices[a].data.sensor1000.value?"FLiRS":"Sleeping":"Routing";this.F.push({id:a,usage:this.g.T(a),type:c,x:null,y:null,name:this.a.devices[a].data.givenName.value,dead:this.a.devices[a].data.isFailed.value});c=this.a.devices[a].data.neighbours.value.slice();for(var d in this.a.devices)d=parseInt(d,10),-1===c.indexOf(d)&&(this.a.devices[d]&&-1!==this.a.devices[d].data.neighbours.value.indexOf(a)?(console.log("Adding asymmetrical route "+a+" -> "+d+" to official neighbour list"),c.push(d)):
this.a.devices[d]&&1!==this.a.devices[d].data.basicType.value&&(0<this.b.usage(a,d)||0<this.b.usage(d,a))&&this.a.devices[d]&&(console.log("Adding actual route "+a+" -> "+d+" to official neighbour list"),c.push(d)));c.forEach(function(c){if(a!=c){var d=b.links.filter(function(b){return b.source==c&&b.target==a})[0];d?Object.assign(d,{rssi21:b.b.H(a,c),usage21:b.b.usage(a,c),fails21:b.b.M(a,c)}):b.links.push({source:a,target:c,rssi12:b.b.H(a,c),usage12:b.b.usage(a,c),fails12:b.b.M(a,c)})}})}}};e.prototype.Z=
function(){var b=this;this.F.map(function(a){var c=b.W.filter(function(b){return b.id===a.id})[0];c&&(a.x=c.x,a.y=c.y)})};e.prototype.X=function(){for(b in this.a.devices){var b=parseInt(b,10);var a=[];var c=this.a.devices[b].instances,d;for(d in c){if(c[d].commandClasses[133])for(e in c[d].commandClasses[133].data){var e=parseInt(e,10);!isNaN(e)&&c[d].commandClasses[133].data[e].nodes.value&&c[d].commandClasses[133].data[e].nodes.value.forEach(function(b){a.push(b)})}if(c[d].commandClasses[142])for(e in c[d].commandClasses[142].data)if(e=
parseInt(e,10),!isNaN(e)&&c[d].commandClasses[142].data[e].nodesInstances.value){var f=0;c[d].commandClasses[142].data[e].nodesInstances.value.forEach(function(b){0===f++%2&&a.push(b)})}}n(a);this.L[b]=r(a)}};e.prototype.S=function(b){return this.L[b]};e.prototype.U=function(){return this.F};e.prototype.P=function(){return this.links};e.prototype.R=function(){return this.i};e.prototype.B=function(b){return this.g.B(b)};e.prototype.C=function(b,a){return this.g.C(b,a)};e.prototype.D=function(b,a){return this.g.D(b,
a)};return e}();window.ZWaveNetworkAnalyticsLib.prototype.getNodes=window.ZWaveNetworkAnalyticsLib.prototype.U;window.ZWaveNetworkAnalyticsLib.prototype.getLinks=window.ZWaveNetworkAnalyticsLib.prototype.P;window.ZWaveNetworkAnalyticsLib.prototype.getMyNodeId=window.ZWaveNetworkAnalyticsLib.prototype.R;window.ZWaveNetworkAnalyticsLib.prototype.getNodeAssociations=window.ZWaveNetworkAnalyticsLib.prototype.S;window.ZWaveNetworkAnalyticsLib.prototype.getNodesRoutedFor=window.ZWaveNetworkAnalyticsLib.prototype.B;
window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryLinkMap=window.ZWaveNetworkAnalyticsLib.prototype.C;window.ZWaveNetworkAnalyticsLib.prototype.getTrajectoryStats=window.ZWaveNetworkAnalyticsLib.prototype.D;